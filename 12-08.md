# Домашнее задание к занятию 12.8 "Резервное копирование баз данных" - Удеревский Евгений


---

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надежность работы БД и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1 Необходимо восстанавливать данные в полном объеме за предыдущий день.

1.2 Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую/починеную БД?

### Ответ
1.1 В данном случае подходит метод инкрементного резервного копирования, полный бэкап делается каждое воскресенье, а остальные дни пишутся инкрементные копии.  
1.2 В данном случае подойдет стратегия полного резервного копирования ежедневно, дифференциальное копирование каждые 4 часа и каждый час инкрементное резервное копирование.  
1.3 Возможно использование репликации, когда кроме «главного» сервера («Мастера») постоянно работают ведомые сервера MySQL («слейвы»), которые получают инкрементные бэкапы с мастера в режиме реального времени.

### Задание 2. PostgreSQL

2.1 С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1* Возможно ли автоматизировать этот процесс? Если да, то как?

### Ответ
2.1  
```sql 
pg_dump zabbix > /tmp/zabbix.dump  
pg_restore -d zabbix /tmp/zabbix.dump
``` 
2.1* Можно использовать скрипт и настроить регулярное выполнение в crontab
```sql
#!/bin/sh

PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin

PGPASSWORD=some_password
export PGPASSWORD
pathB=/mnt/backup
dbUser=dbadmin
database=zabbix

pg_dump -U $dbUser $database  > $pathB/pgsql_$(date "+%Y-%m-%d").dump


unset PGPASSWORD
```

### Задание 3. MySql

3.1 С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySql. 

3.1* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

### Ответ
3.1 После полного бекапа  
```sql
mysqldump -uroot -p --all-databases --single-transaction --flush-logs --master-data=2 > full_backup.sql
```
сделать инкерментный бэкап:
```sql
mysqladmin -uroot -p flush-logs
```
3.1* 
